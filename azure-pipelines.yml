jobs:
- job: linux
  displayName: Linux
  pool:
    vmImage: 'ubuntu-latest'
  strategy:
    matrix:
      python3.6:
        python.version: '3.6'

  variables:
    CONDA_PKGS_DIRS: $(Pipeline.Workspace)/.conda/pkgs

  steps:

  #- task: Cache@2
  #  inputs:
  #    key: 'conda | "$(Agent.OS)" | "python$(python.version)"'
  #    path: $(CONDA_PKGS_DIRS)
  #    restoreKeys: |
  #      conda | "$(Agent.OS)"
  #  displayName: Cache Conda packages

  - bash: |
      set -ex
      echo "##vso[task.prependpath]$CONDA/bin"
      conda config --set always_yes yes
      conda config --add channels conda-forge
      conda update --yes --quiet --name base conda
      conda info --all
      conda config --show-sources
      conda list --show-channel-urls
    displayName: Configure Conda

  - bash: |
      /bin/bash --version
      env
      alias
      declare -F
    displayName: "Debugging: environment"

  - bash: declare -f
    displayName: "Debugging: function definitions"

  - bash: |
        source ${CONDA}/etc/profile.d/conda.sh
        type __add_sys_prefix_to_path
        type __conda_activate
    displayName: "Debugging: function definitions"

  - bash: |
      set -ex
      source ${CONDA}/etc/profile.d/conda.sh
      conda activate base
      conda list
    displayName: test
